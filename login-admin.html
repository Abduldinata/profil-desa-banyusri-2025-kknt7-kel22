<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel - Desa Banyusri</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/login-admin.css" />
</head>
<body>
  <!-- 🔐 LOGIN FORM -->
  <div id="loginContainer" class="login-container">
    <div class="logo">🏘️</div>
    <h1>Admin Panel</h1>
    <p class="subtitle">Desa Banyusri</p>
    <div class="firebase-status">
      <span id="firebaseStatus" class="status-indicator status-offline"></span>
      <span id="firebaseStatusText">Connecting to Firebase...</span>
    </div>
    <div id="loginAlert"></div>
    <form id="loginForm" autocomplete="on">
      <div class="form-group">
        <label for="username">Email</label>
        <input type="email" id="username" name="username" autocomplete="username" required />
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" name="password" autocomplete="current-password" required />
      </div>
      <button type="submit" class="btn">🔐 Login</button>
    </form>
  </div>

    <!-- 👤 ADMIN PANEL -->
  <div id="adminContainer" class="admin-container" style="display: none;">
    <button class="logout-btn" onclick="logout()">🚪 Logout</button>
    <h1>🏘️ Admin Panel Desa Banyusri</h1>
    <p class="subtitle">Kelola konten & data website desa</p>

    <div class="tabs">
      <button class="tab active" onclick="showTab('tabPengaduan')">📝 Pengaduan</button>
      <button class="tab" onclick="showTab('tabKontak')">📇 Kontak</button>
      <button class="tab" onclick="showTab('tabUsers')">👥 Users</button>
      <button class="tab" onclick="showTab('tabBackup')">💾 Backup</button>
    </div>

    <!-- TAB: PENGADUAN -->
    <div id="tabPengaduan" class="tab-content active">
      <h2>📝 Link Form Pengaduan</h2>
      <div id="pengaduanLoading">🔄 Memuat data...</div>
      <div id="pengaduanData" style="display: none;">
        <p><strong>Form Saat Ini:</strong> <a id="currentFormLink" href="#" target="_blank"></a></p>
        <p><small>Last update: <span id="formLastUpdate"></span> by <span id="formUpdatedBy"></span></small></p>
        <form id="pengaduanForm">
          <input type="url" id="googleFormLink" required placeholder="Link Google Form" />
          <button type="submit">💾 Update</button>
        </form>
        <div id="formPreview" style="display:none;">
          <h3>📄 Preview Form:</h3>
          <iframe id="previewIframe" width="100%" height="500" style="border: 1px solid #ccc;"></iframe>
        </div>
      </div>
    </div>

        <!-- TAB: KONTAK -->
    <div id="tabKontak" class="tab-content">
      <h2>📇 Kontak Desa</h2>
      <div id="kontakLoading">🔄 Memuat data...</div>
      <div id="kontakData" style="display: none;">
        <form id="kontakForm">
          <input type="text" id="kepalaDesa" placeholder="Nama Kepala Desa" />
          <input type="text" id="sekretarisDesa" placeholder="Nama Sekretaris" />
          <input type="text" id="whatsappDesa" placeholder="WhatsApp Desa" />
          <input type="email" id="emailDesa" placeholder="Email Desa" />
          <input type="text" id="telefonDesa" placeholder="Telepon Kantor" />
          <textarea id="alamatDesa" placeholder="Alamat Desa"></textarea>
          <input type="text" id="jamOperasional" placeholder="Jam Operasional" />
          <button type="submit">💾 Simpan Kontak</button>
        </form>
      </div>
    </div>

    <!-- TAB: USERS -->
    <div id="tabUsers" class="tab-content">
      <h2>👥 Daftar Admin</h2>
      <div id="usersLoading">🔄 Memuat daftar...</div>
      <div id="usersData" style="display:none;">
        <div id="usersList"></div>
        <h3>➕ Tambah User</h3>
        <form id="addUserForm">
          <input type="text" id="newUsername" placeholder="Username (email)" required />
          <input type="password" id="newPassword" placeholder="Password" required />
          <input type="text" id="userFullName" placeholder="Nama Lengkap" required />
          <select id="userRole">
            <option value="admin">Admin</option>
            <option value="sekretaris">Sekretaris</option>
            <option value="kepala_desa">Kepala Desa</option>
          </select>
          <button type="submit">➕ Tambah</button>
        </form>
      </div>
    </div>

    <!-- TAB: BACKUP -->
    <div id="tabBackup" class="tab-content">
      <h2>💾 Backup & Restore</h2>
      <p>🔽 Download semua data admin:</p>
      <button onclick="downloadBackup()">⬇ Download JSON</button>
      <p>📤 Upload file JSON untuk restore:</p>
      <input type="file" id="backupFile" />
      <button onclick="restoreBackup()">📤 Upload</button>
    </div>
  </div>

    <!-- Firebase SDK -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-firestore-compat.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-auth-compat.min.js"></script>

  <!-- Script Admin Panel -->
  <script src="js/script.js"></script>

  <!-- Firebase Init & Auth -->
  <script>

    document.addEventListener("DOMContentLoaded", () => {
      const loginForm = document.getElementById("loginForm");
      const loginAlert = document.getElementById("loginAlert");
      const loginContainer = document.getElementById("loginContainer");
      const adminContainer = document.getElementById("adminContainer");

      firebase.auth().onAuthStateChanged((user) => {
        const statusIcon = document.getElementById("firebaseStatus");
        const statusText = document.getElementById("firebaseStatusText");
        if (user) {
          loginContainer.style.display = "none";
          adminContainer.style.display = "block";
          if (statusIcon) statusIcon.classList.add("status-online");
          if (statusText) statusText.textContent = "Connected";
        } else {
          loginContainer.style.display = "block";
          adminContainer.style.display = "none";
        }
      });

      if (loginForm) {
        loginForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const email = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value.trim();

          firebase.auth().signInWithEmailAndPassword(email, password)
            .catch((error) => {
              loginAlert.innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
            });
        });
      }
    });

    function logout() {
      firebase.auth().signOut().then(() => location.reload());
    }
  </script>
</body>
</html>
